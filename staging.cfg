[buildout]
extends =
    base.cfg
    secret.cfg
    local-converters.cfg

newest = false

parts +=
    run-automatic-apps
    supervisor
    i18ndude

eggs +=
    Products.ZMIntrospection
    collective.codemirror

extensions = mr.developer
auto-checkout = *
always-checkout = True


[gunicorn]
port = 5001


#instance extends base.cfg:instance
[instance]
http-address = 2881
user = admin:${secrets:ADMIN_KEY}

debug-mode = off
verbose-security = off

event-log-level = INFO
event-log = ${buildout:directory}/logs/event.log

z2-log-level = INFO
z2-log = ${buildout:directory}/logs/Z2.log


[run-automatic-apps]
recipe = z3c.recipe.usercrontab
times = */2 * * * *

account = qaaccount:${secrets:QAACCOUNT}
path = ReportekEngine/runAutomaticApplications?p_applications=AutomaticQA

command = wget --no-check-certificate -q -O /dev/null http://${:account}@$127.0.0.1:${instance:http-address}/${:path}


[i18ndude]
unzip = true
recipe = zc.recipe.egg
eggs = i18ndude
interpreter = py


#mr.developer config: https://pypi.python.org/pypi/mr.developer
[sources]
Products.Reportek = svn https://svn.eionet.europa.eu/repositories/Zope/trunk/Products.Reportek/


[supervisor]
recipe = collective.recipe.supervisor
logfile = ${buildout:directory}/logs/supervisor/supervisor.log
childlogdir = ${buildout:directory}/logs/supervisor
http-socket = unix
file = ${buildout:directory}/var/supervisor.sock
user = admin
password = ${secrets:SUPERVISOR_PWD}

programs =
    50 instance ${buildout:directory}/bin/instance [console] true
    80 converters ${buildout:directory}/bin/gunicorn [-b ${gunicorn:address}:${gunicorn:port} ${gunicorn:app_module}] ${buildout:eggs-directory}/reportek.converters.egg/Products/reportek.converters/ true
